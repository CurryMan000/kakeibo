<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家計簿アプリ</title>
</head>
<body>

<h1>家計簿</h1>

<!-- 入力フォーム -->
<div>
    <input type="date" id="date" />
    <input type="text" id="category" placeholder="カテゴリー" />
    <input type="number" id="amount" placeholder="金額" />
    <button id="saveBtn">保存</button>
</div>

<h2>データ</h2>
<ul id="dataList"></ul>

<!-- ファイル選択 -->
<input type="file" id="fileInput" accept=".json" />

<script>
    let data = [];  // 保存するデータ

    // ページ読み込み時にファイルからデータを読み込む
    window.onload = function() {
        // もしローカルストレージに保存されたデータがあれば読み込む
        const savedData = localStorage.getItem("budgetData");
        if (savedData) {
            data = JSON.parse(savedData);
            displayData();
        }

        // ファイル入力があれば読み込む
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const fileData = JSON.parse(e.target.result);
                        data = fileData;
                        displayData();
                    } catch (error) {
                        console.error("JSONファイルの解析エラー:", error);
                    }
                };
                reader.readAsText(file);
            }
        });
    };

    // データを表示する
    function displayData() {
        const dataList = document.getElementById("dataList");
        dataList.innerHTML = '';  // 以前のリストを消す
        data.forEach(item => {
            const li = document.createElement("li");
            li.textContent = `${item.date} | ${item.category} | ¥${item.amount}`;
            dataList.appendChild(li);
        });
    }

    // 保存ボタンが押された時の処理
    document.getElementById("saveBtn").addEventListener("click", function() {
        const date = document.getElementById("date").value;
        const category = document.getElementById("category").value;
        const amount = document.getElementById("amount").value;

        if (date && category && amount) {
            const newData = { date, category, amount: parseInt(amount) };
            data.push(newData);

            // ローカルストレージに保存
            localStorage.setItem("budgetData", JSON.stringify(data));

            // データを再表示
            displayData();

            // 入力欄をクリア
            document.getElementById("date").value = '';
            document.getElementById("category").value = '';
            document.getElementById("amount").value = '';
        } else {
            alert("すべての項目を入力してください。");
        }
    });

    // JSONファイルとして保存する
    function saveToFile() {
        const jsonData = JSON.stringify(data);
        const blob = new Blob([jsonData], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'budget_data.json'; // ファイル名
        link.click();
    }

    // ページ終了時に保存（オプション）
    window.onbeforeunload = function() {
        localStorage.setItem("budgetData", JSON.stringify(data));
    };
</script>

</body>
</html>
